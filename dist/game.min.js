function Tile(t,e,o,r,n,i){"use strict";this.ctx=t,this.n=e,this.x=o,this.y=r,this.s=n,this.r=i,this.c="#193441";var s=Math.round(n/2);this.font="700 "+s+"px fantasy",this.moves={right:["x",1],left:["x",-1],up:["y",-1],down:["y",1]}}function Game(){function t(){var t=Object.keys(r);return t.every(function(t){if("0"===t)return!0;var o=e(+t-1);return o.col===r[t].col&&o.row===r[t].row})}function e(t){return{col:t%4,row:Math.floor(t/4)}}function o(t,e,o){function r(){return Math.random()-.5}function n(t,e,o,r,n,i){for(n=0,e=1,r=t.length-1;e<r;e++)for(o=e-1;o>=0;o--)t[o]>t[e]&&n++;return i=n%2,!i}return t=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],e=t.sort(r).concat(0),n(e)||(o=e[0],e[0]=e[1],e[1]=o),e}var r;this.init=function(){this.numbers=o(),r={},this.numbers.forEach(function(t,o){r[t]=e(o)})},this.move=function(e,o){var n,i,s=r[0],c=Object.keys(r),a=[],u=0,l=0;if("up"===e){if(3===s.row)return;for(;u<16;u++)if(n=r[c[u]],n.col===s.col&&n.row>s.row)if(o)n.row-=1,l+=1,a.push(c[u]);else if(n.row===s.row+1){n.row-=1,l+=1,a.push(c[u]);break}s.row+=l}else if("down"===e){if(0===s.row)return;for(;u<16;u++)if(n=r[c[u]],n.col===s.col&&n.row<s.row)if(o)n.row+=1,l-=1,a.push(c[u]);else if(n.row===s.row-1){n.row+=1,l-=1,a.push(c[u]);break}s.row+=l}else if("left"===e){if(3===s.col)return;for(;u<16;u++)if(n=r[c[u]],n.row===s.row&&n.col>s.col)if(o)n.col-=1,l+=1,a.push(c[u]);else if(n.col===s.col+1){n.col-=1,l+=1,a.push(c[u]);break}s.col+=l}else if("right"===e){if(0===s.col)return;for(;u<16;u++)if(n=r[c[u]],n.row===s.row&&n.col<s.col)if(o)n.col+=1,l-=1,a.push(c[u]);else if(n.col===s.col-1){n.col+=1,l-=1,a.push(c[u]);break}s.col+=l}return i=t(),{move:e,arr:a,completed:i}},this.checkLine=function(t){return r[t].col===r[0].col||r[t].row===r[0].row},this.checkState=function(e){var o,n,i=r[0],s=[],c=Object.keys(r);if(r[e].col===i.col)n=i.row-r[e].row,o=n>0?"down":"up",c.forEach(function(t){+t&&r[t].col===i.col&&("down"===o?r[t].row>=r[e].row&&r[t].row<i.row&&(r[t].row+=1,s.push(t)):r[t].row<=r[e].row&&r[t].row>i.row&&(r[t].row-=1,s.push(t)))}),i.row-=n;else{if(r[e].row!==i.row)return;n=i.col-r[e].col,o=n>0?"right":"left",c.forEach(function(t){+t&&r[t].row===i.row&&("right"===o?r[t].col>=r[e].col&&r[t].col<i.col&&(r[t].col+=1,s.push(t)):r[t].col<=r[e].col&&r[t].col>i.col&&(r[t].col-=1,s.push(t)))}),i.col-=n}var a=t();return{move:o,arr:s,completed:a}}}function Props(){var t=.85*Math.min(window.innerWidth,window.innerHeight);t=t<=450?t:450,this.gap=Math.round(t/45),this.size=45*this.gap,this.marginLeft=Math.round((window.innerWidth-this.size)/2),this.marginTop=Math.round((window.innerHeight-this.size)/2),this.tile=10*this.gap}function Timer(t,e){function o(t){var e=parseInt(t/1e3%60),o=parseInt(t/6e4%60),r=parseInt(t/36e5%24);return r=r<10?"0"+r:r,o=o<10?"0"+o:o,e=e<10?"0"+e:e,r+":"+o+":"+e}var r,n,i=e.size/2;this.stopped=!1,this.start=function(){this.stopped=!1,r=Date.now()},this.stop=function(){this.stopped=!0;var t=Date.now();n=o(t-r)},this.draw=function(){var o=e.size/6;t.save(),t.globalAlpha=.8,t.fillStyle="#193441",t.fillRect(0,0,e.size,e.size),t.restore(),t.lineWidth=1,t.strokeStyle="#193441",t.font="700 "+o+"px fantasy",t.save(),t.globalCompositeOperation="destination-out",t.fillText(n,i,i),t.restore(),t.strokeText(n,i,i)}}Tile.prototype.draw=function(){var t=this;t.ctx.roundRect(t.x,t.y,t.s,t.s,t.r),t.ctx.fillStyle=t.c,t.ctx.fill(),t.ctx.font=t.font,t.ctx.strokeStyle="#91AA9D",t.ctx.lineWidth=1,t.ctx.strokeText(t.n,t.x+t.s/2,t.y+t.s/2)},Tile.prototype.update=function(t,e){var o=this.moves[t],r=o[0]+"_init";0===e?this[r]=this[o[0]]:this[o[0]]=this[r]+o[1]*(this.s+this.r)*e},function(){"use strict";function t(t,e){var o,r,n=[];return t.forEach(function(t,i){t&&(o=e.gap+i%4*(e.tile+e.gap),r=e.gap+Math.floor(i/4)*(e.tile+e.gap),n[i]=new Tile(k,t.toString(),o,r,e.tile,e.gap))}),n}function e(){k.clearRect(0,0,x.size,x.size),k.strokeStyle="#193441",k.lineWidth=6,k.strokeRect(0,0,x.size,x.size),g.forEach(function(t){t.draw()}),E.stopped&&E.draw()}function o(){m.addEventListener("mouseleave",u,!1),m.addEventListener("click",l,!1),m.addEventListener("mousemove",w,!1),window.addEventListener("keyup",a,!1)}function r(){m.removeEventListener("mouseleave",u),m.removeEventListener("click",l),m.removeEventListener("mousemove",w),window.removeEventListener("keyup",a)}function n(){b.init(),E.start(),g=t(b.numbers,x),o(),e()}function i(){var t="none"===y.style.display;y.style.display=t?"table":"none"}function s(t,e){var o=b.move(t,e);o&&f(o)}function c(t){switch(t.keyCode){case 32:n();break;case 27:i()}}function a(t){switch(t.keyCode){case 87:s("up",!0);break;case 38:s("up");break;case 83:s("down",!0);break;case 40:s("down");break;case 68:s("right",!0);break;case 39:s("right");break;case 65:s("left",!0);break;case 37:s("left")}}function u(){for(var t=0;t<15;t++)g[t].c="#193441";m.style.cursor="auto",e()}function l(t){for(var e=p(m,t),o=0;o<15;o++)if(d(e,g[o])){var r=b.checkState(g[o].n);r&&f(r);break}}function f(t){function o(c){n=n||c;var a=(c-n)/i;a>=1?(r.forEach(function(e){e.update(t.move,1)}),cancelAnimationFrame(s),t.completed&&h(),e()):(r.forEach(function(e){e.update(t.move,a),e.c="#193441"}),e(),s=requestAnimationFrame(o))}var r=[];g.forEach(function(e){t.arr.indexOf(e.n)!==-1&&r.push(e)});var n,i=160,s=requestAnimationFrame(o)}function h(){r();for(var t=0;t<15;t++)g[t].c="#FCFFF5";m.style.cursor="auto",E.stop()}function w(t){for(var o=p(m,t),r="auto",n=0;n<15;n++)d(o,g[n])&&b.checkLine(g[n].n)?(g[n].c="#3E606F",r="pointer"):g[n].c="#193441";m.style.cursor=r,e()}function p(t,e){var o=t.getBoundingClientRect();return{x:e.pageX-o.left,y:e.pageY-o.top}}function d(t,e){return v(t.x,e.x,e.x+e.s)&&v(t.y,e.y,e.y+e.s)}function v(t,e,o){return t>=Math.min(e,o)&&t<=Math.max(e,o)}CanvasRenderingContext2D.prototype.roundRect=function(t,e,o,r,n){return o<2*n&&(n=o/2),r<2*n&&(n=r/2),this.beginPath(),this.moveTo(t+n,e),this.arcTo(t+o,e,t+o,e+r,n),this.arcTo(t+o,e+r,t,e+r,n),this.arcTo(t,e+r,t,e,n),this.arcTo(t,e,t+o,e,n),this.closePath(),this};var m=document.querySelector("canvas"),y=document.querySelector(".help-outer");y.style.display="none";var g,k=m.getContext("2d"),x=new Props,b=new Game,E=new Timer(k,x);m.width=m.height=x.size,m.style.marginLeft=x.marginLeft+"px",m.style.marginTop=x.marginTop+"px",k.textAlign="center",k.textBaseline="middle",window.addEventListener("keyup",c,!1),n()}();
//# sourceMappingURL=game.min.js.map
